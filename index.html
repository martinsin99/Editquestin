<html lang="es"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Preguntas Moodle</title>
    <!-- 1. Se incluye Tailwind CSS directamente para que los estilos funcionen sin instalación -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos adicionales para mejorar la apariencia y el scroll */
        html, body {
            height: 100%;
            overflow: hidden;
        }
        .hide-scrollbar {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
        .cell-textarea {
            min-height: 75px; /* Altura mínima para las celdas de texto */
        }
        .selected-row {
            background-color: #EBF8FF; /* Un azul claro para las filas seleccionadas */
        }
        /* Animación para el mensaje de guardado */
        .fade-out {
            animation: fadeOut 2s forwards;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.-top-6{top:-1.5rem}.left-0{left:0px}.left-1\/2{left:50%}.top-0{top:0px}.right-2{right:0.5rem}.top-2{top:0.5rem}.z-20{z-index:20}.z-50{z-index:50}.z-\[60\]{z-index:60}.col-span-full{grid-column:1 / -1}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mt-4{margin-top:1rem}.mt-1{margin-top:0.25rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-5{height:1.25rem}.h-64{height:16rem}.h-full{height:100%}.h-screen{height:100vh}.h-4{height:1rem}.max-h-0{max-height:0px}.max-h-60{max-height:15rem}.max-h-\[90vh\]{max-height:90vh}.w-5{width:1.25rem}.w-full{width:100%}.w-4{width:1rem}.max-w-2xl{max-width:42rem}.max-w-4xl{max-width:56rem}.max-w-lg{max-width:32rem}.max-w-screen-2xl{max-width:1536px}.flex-grow{flex-grow:1}.-translate-x-1\/2{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.resize-none{resize:none}.resize-y{resize:vertical}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-end{align-items:flex-end}.items-center{align-items:center}.items-stretch{align-items:stretch}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-3 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.75rem * var(--tw-space-x-reverse));margin-left:calc(0.75rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-x-1 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.25rem * var(--tw-space-x-reverse));margin-left:calc(0.25rem * calc(1 - var(--tw-space-x-reverse)))}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.rounded-xl{border-radius:0.75rem}.rounded-full{border-radius:9999px}.rounded-b-xl{border-bottom-right-radius:0.75rem;border-bottom-left-radius:0.75rem}.border{border-width:1px}.border-0{border-width:0px}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-r{border-right-width:1px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-red-400{--tw-border-opacity:1;border-color:rgb(248 113 113 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.bg-red-100{--tw-bg-opacity:1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-teal-600{--tw-bg-opacity:1;background-color:rgb(13 148 136 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-500{--tw-bg-opacity:1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.bg-transparent{background-color:transparent}.bg-opacity-50{--tw-bg-opacity:0.5}.p-1{padding:0.25rem}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-16{padding:4rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.font-sans{font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"}.text-2xl{font-size:1.5rem;line-height:2rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.tracking-wider{letter-spacing:0.05em}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-red-700{--tw-text-opacity:1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.opacity-0{opacity:0}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.ease-in-out{transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-300:hover{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-700:hover{--tw-bg-opacity:1;background-color:rgb(67 56 202 / var(--tw-bg-opacity, 1))}.hover\:bg-red-600:hover{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.hover\:bg-teal-700:hover{--tw-bg-opacity:1;background-color:rgb(15 118 110 / var(--tw-bg-opacity, 1))}.hover\:bg-yellow-600:hover{--tw-bg-opacity:1;background-color:rgb(202 138 4 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-50:hover{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.hover\:text-blue-600:hover{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.hover\:text-blue-800:hover{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.hover\:text-red-800:hover{--tw-text-opacity:1;color:rgb(153 27 27 / var(--tw-text-opacity, 1))}.focus\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.focus\:bg-white:focus{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-0:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-1:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-400:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(96 165 250 / var(--tw-ring-opacity, 1))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:bg-gray-400:disabled{--tw-bg-opacity:1;background-color:rgb(156 163 175 / var(--tw-bg-opacity, 1))}.disabled\:opacity-50:disabled{opacity:0.5}@media (min-width: 768px){.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:grid-cols-5{grid-template-columns:repeat(5, minmax(0, 1fr))}.lg\:p-6{padding:1.5rem}}</style></head>
<body class="bg-gray-100 font-sans flex flex-col h-screen">
 
    <!-- Encabezado y Barra de Herramientas -->
    <header class="bg-white shadow-md p-4 z-20">
        <div class="max-w-screen-2xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">Editor de Preguntas Moodle</h1>
                <p class="text-sm text-gray-500">Virtualizado para Máximo Rendimiento</p>
            </div>
            <div class="flex items-center space-x-2">
                <button id="toggle-view-btn" class="p-2 rounded-lg hover:bg-gray-200 transition-colors" title="Cambiar Vista">
                    <svg id="table-view-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18M3 6h18M3 18h18"></path></svg>
                    <svg id="text-view-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg>
                </button>
                <button id="undo-btn" class="p-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Deshacer (Ctrl+Z)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15l-3-3m0 0l3-3m-3 3h8A5 5 0 009 9V5"></path></svg>
                </button>
                <button id="redo-btn" class="p-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Rehacer (Ctrl+Y)" disabled="">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 15l3-3m0 0l-3-3m3 3H5a5 5 0 005 5v-2a3 3 0 013-3z"></path></svg>
                </button>
                <div class="relative">
                    <button id="save-btn" class="p-2 rounded-lg hover:bg-gray-200 transition-colors" title="Guardar Progreso">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3l-4-4-4 4z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    </button>
                    <span id="save-feedback" class="absolute -top-6 left-1/2 -translate-x-1/2 text-xs bg-green-500 text-white px-2 py-1 rounded-md opacity-0">Guardado</span>
                </div>
                <button id="settings-btn" class="p-2 rounded-lg hover:bg-gray-200 transition-colors" title="Edición Masiva">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                </button>
                <input type="file" id="xml-file-input" class="hidden" accept=".xml">
                <input type="file" id="csv-file-input" class="hidden" accept=".csv">
                <button id="import-paste-btn" class="flex items-center px-4 py-2 bg-yellow-500 text-white font-semibold rounded-lg shadow-md hover:bg-yellow-600">Pegar CSV</button>
                <button id="import-xml-btn" class="flex items-center px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">Importar XML</button>
                <button id="import-csv-btn" class="flex items-center px-4 py-2 bg-teal-600 text-white font-semibold rounded-lg shadow-md hover:bg-teal-700">Importar CSV</button>
                <button id="export-btn" class="flex items-center px-4 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 disabled:bg-gray-400">Exportar</button>
            </div>
        </div>
        <div id="settings-bar" class="transition-all duration-300 ease-in-out overflow-hidden max-h-0">
            <div class="bg-gray-50 p-4 rounded-lg border mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end">
                <h3 class="font-semibold text-gray-700 col-span-full">Edición Masiva:</h3>
                <div><label class="block text-xs font-medium text-gray-600">Año</label><input type="text" id="global-year" placeholder="Ej: 2025" class="p-2 border rounded-md text-sm w-full"></div>
                <div><label class="block text-xs font-medium text-gray-600">Tipo de Examen</label><input type="text" id="global-exam" placeholder="Ej: Parcial 1" class="p-2 border rounded-md text-sm w-full"></div>
                <div><label class="block text-xs font-medium text-gray-600">Categoría/Materia</label><input type="text" id="global-category" placeholder="Ej: Medicina" class="p-2 border rounded-md text-sm w-full"></div>
                <div><label class="block text-xs font-medium text-gray-600">Tema</label><input type="text" id="global-topic" placeholder="Ej: Cardiología" class="p-2 border rounded-md text-sm w-full"></div>
                <button id="apply-massive-edit" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 w-full">Aplicar a Todo</button>
            </div>
        </div>
    </header>
 
    <!-- Contenido Principal -->
    <main class="flex-grow p-4 lg:p-6 flex flex-col overflow-hidden">
        <div id="error-container" class="hidden max-w-screen-2xl mx-auto bg-red-100 border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4"></div>
        <div id="table-view" class="flex-grow flex flex-col bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden">
            <!-- Encabezado de la Tabla -->
            <div id="table-header" class="overflow-x-auto hide-scrollbar border-b border-gray-200"><div class="flex items-center bg-gray-50 font-medium text-xs text-gray-500 uppercase tracking-wider" style="width: 2390px;"><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 40px;"><input type="checkbox" id="select-all-checkbox"></div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 50px;">#</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 80px;">Acciones</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 350px;">Texto de la Pregunta</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 200px;">Opción A</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 200px;">Opción B</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 200px;">Opción C</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 200px;">Opción D</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 120px;">Resp. Correcta</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 150px;">Categoría</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 100px;">Año</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 150px;">Tipo Examen</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 150px;">Tema</div><div class="px-3 py-3 border-r border-gray-200 flex items-center justify-center" style="flex: 0 0 400px;">Justificación</div></div></div>
            <!-- Cuerpo de la Tabla (Virtualizado) -->
            <div id="table-body-container" class="flex-grow w-full h-full overflow-auto">
                <div id="table-body-sizer" class="relative" style="height: 113905px;">
                    <div id="table-body" class="absolute top-0 left-0 w-full"><div class="absolute top-0 left-0 w-full " data-index="0" style="top: 0px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">1</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="1" style="top: 95px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">2</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="2" style="top: 190px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">3</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="3" style="top: 285px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">4</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="4" style="top: 380px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">5</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="5" style="top: 475px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">6</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="6" style="top: 570px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">7</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="7" style="top: 665px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">8</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="8" style="top: 760px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">9</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="9" style="top: 855px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">10</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="10" style="top: 950px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">11</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="11" style="top: 1045px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">12</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="12" style="top: 1140px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">13</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="13" style="top: 1235px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">14</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="14" style="top: 1330px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">15</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div><div class="absolute top-0 left-0 w-full " data-index="15" style="top: 1425px; height: 95px;"><div class="flex items-stretch border-b border-gray-200 h-full" style="width: 2390px;"><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 40px;"><div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4"></div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 50px;"><div class="w-full h-full flex items-center justify-center text-sm text-gray-500">16</div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 80px;"><div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 350px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="text"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_a"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_b"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_c"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 200px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="option_d"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 120px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="correctAnswerId"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="category"></textarea><button class="absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn" title="Clasificar rápido"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg></button></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 100px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="year"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="examType"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 150px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="topic"></textarea></div><div class="px-2 py-1 flex items-center border-r border-gray-200 relative" style="flex: 0 0 400px;"><textarea class="w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea" data-field="justification"></textarea></div></div></div></div>
                </div>
            </div>
        </div>
        <div id="text-view" class="hidden flex-grow flex flex-col bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden">
            <textarea id="text-view-area" class="w-full h-full p-4 font-mono text-sm border-0 focus:ring-0 resize-none"></textarea>
        </div>
    </main>
 
    <!-- Barra de Herramientas Avanzada (oculta por defecto) -->
    <div id="advanced-toolbar" class="hidden bg-gray-800 text-white p-3 shadow-lg transition-transform duration-300 ease-in-out">
        <div class="max-w-screen-2xl mx-auto flex justify-between items-center">
            <span id="selection-count">0 filas seleccionadas</span>
            <div class="flex items-center space-x-4">
                <button id="batch-edit-btn" class="flex items-center px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg">Modificar Selección</button>
                <button id="batch-delete-btn" class="flex items-center px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg">Eliminar Selección</button>
            </div>
        </div>
    </div>
 
    <!-- Modal de Edición -->
    <div id="modal-container" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center"><h2 id="modal-title" class="text-xl font-bold text-gray-800">Editar Pregunta</h2></header>
            <main id="modal-content" class="p-6 overflow-y-auto"></main>
            <footer class="p-4 border-t flex justify-between items-center bg-gray-50 rounded-b-xl">
                <div>
                    <button id="modal-prev" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">Anterior</button>
                    <button id="modal-next" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">Siguiente</button>
                </div>
                <div>
                    <button id="modal-cancel" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cerrar</button>
                    <button id="modal-save" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">Guardar y Cerrar</button>
                </div>
            </footer>
        </div>
    </div>
     
    <!-- Modal para Pegar CSV -->
    <div id="paste-modal-container" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl flex flex-col">
            <header class="p-4 border-b"><h2 class="text-xl font-bold text-gray-800">Pegar Contenido CSV</h2></header>
            <main class="p-6">
                <p class="text-sm text-gray-600 mb-2">Pega aquí las filas de tu CSV. Asegúrate de que el formato y las columnas coincidan con la exportación.</p>
                <textarea id="paste-csv-area" class="w-full h-64 p-2 border rounded-md font-mono text-sm" placeholder="text,option_a,option_b,..."></textarea>
            </main>
            <footer class="p-4 border-t flex justify-end space-x-3 bg-gray-50 rounded-b-xl">
                <button id="paste-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancelar</button>
                <button id="paste-process-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">Procesar y Añadir</button>
            </footer>
        </div>
    </div>
 
    <!-- Modal para Edición en Conjunto -->
    <div id="batch-edit-modal-container" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg flex flex-col">
            <header class="p-4 border-b"><h2 class="text-xl font-bold text-gray-800">Modificar Selección</h2></header>
            <main class="p-6 space-y-4">
                <p class="text-sm text-gray-600">Introduce los valores que quieres aplicar a todas las filas seleccionadas. Deja un campo en blanco para no modificarlo.</p>
                <div><label class="block text-xs font-medium text-gray-600">Año</label><input type="text" id="batch-year" placeholder="Ej: 2025" class="p-2 border rounded-md text-sm w-full"></div>
                <div><label class="block text-xs font-medium text-gray-600">Tipo de Examen</label><input type="text" id="batch-exam" placeholder="Ej: Parcial 1" class="p-2 border rounded-md text-sm w-full"></div>
                <div><label class="block text-xs font-medium text-gray-600">Categoría/Materia</label><input type="text" id="batch-category" placeholder="Ej: Medicina" class="p-2 border rounded-md text-sm w-full"></div>
                <div><label class="block text-xs font-medium text-gray-600">Tema</label><input type="text" id="batch-topic" placeholder="Ej: Cardiología" class="p-2 border rounded-md text-sm w-full"></div>
            </main>
            <footer class="p-4 border-t flex justify-end space-x-3 bg-gray-50 rounded-b-xl">
                <button id="batch-edit-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancelar</button>
                <button id="batch-edit-apply-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">Aplicar Cambios</button>
            </footer>
        </div>
    </div>
 
    <!-- Menú emergente para Clasificación Rápida -->
    <div id="classify-popup" class="hidden absolute z-[60] bg-white border rounded-lg shadow-xl flex flex-col">
        <input type="text" id="classify-search" class="p-2 border-b focus:outline-none" placeholder="Buscar categoría...">
        <div id="classify-list" class="p-1 max-h-60 overflow-y-auto"></div>
    </div>
 
 
    <!-- 2. Toda la lógica de la aplicación está en este script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- State Management ---
            let questions = [];
            let fileName = 'exportacion_moodle';
            let editingQuestionIndex = null;
            let debounceTimers = {};
            let selectedRows = new Set();
            let history = [];
            let historyIndex = -1;
            let currentView = 'table'; // 'table' or 'text'
 
            // --- DOM Elements ---
            const importXmlBtn = document.getElementById('import-xml-btn');
            const importCsvBtn = document.getElementById('import-csv-btn');
            const importPasteBtn = document.getElementById('import-paste-btn');
            const exportBtn = document.getElementById('export-btn');
            const xmlFileInput = document.getElementById('xml-file-input');
            const csvFileInput = document.getElementById('csv-file-input');
            const errorContainer = document.getElementById('error-container');
            const tableHeader = document.getElementById('table-header');
            const tableBodyContainer = document.getElementById('table-body-container');
            const tableBodySizer = document.getElementById('table-body-sizer');
            const tableBody = document.getElementById('table-body');
            const settingsBtn = document.getElementById('settings-btn');
            const settingsBar = document.getElementById('settings-bar');
            const saveBtn = document.getElementById('save-btn');
            const saveFeedback = document.getElementById('save-feedback');
            const undoBtn = document.getElementById('undo-btn');
            const redoBtn = document.getElementById('redo-btn');
            const toggleViewBtn = document.getElementById('toggle-view-btn');
            const tableViewIcon = document.getElementById('table-view-icon');
            const textViewIcon = document.getElementById('text-view-icon');
            const tableView = document.getElementById('table-view');
            const textView = document.getElementById('text-view');
            const textViewArea = document.getElementById('text-view-area');
            const globalYearInput = document.getElementById('global-year');
            const globalExamInput = document.getElementById('global-exam');
            const globalCategoryInput = document.getElementById('global-category');
            const globalTopicInput = document.getElementById('global-topic');
            const applyMassiveEditBtn = document.getElementById('apply-massive-edit');
            const modalContainer = document.getElementById('modal-container');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const modalSaveBtn = document.getElementById('modal-save');
            const modalCancelBtn = document.getElementById('modal-cancel');
            const modalPrevBtn = document.getElementById('modal-prev');
            const modalNextBtn = document.getElementById('modal-next');
            const classifyPopup = document.getElementById('classify-popup');
            const classifySearch = document.getElementById('classify-search');
            const classifyList = document.getElementById('classify-list');
            const pasteModalContainer = document.getElementById('paste-modal-container');
            const pasteCsvArea = document.getElementById('paste-csv-area');
            const pasteProcessBtn = document.getElementById('paste-process-btn');
            const pasteCancelBtn = document.getElementById('paste-cancel-btn');
            const advancedToolbar = document.getElementById('advanced-toolbar');
            const selectionCount = document.getElementById('selection-count');
            const batchEditBtn = document.getElementById('batch-edit-btn');
            const batchDeleteBtn = document.getElementById('batch-delete-btn');
            const batchEditModalContainer = document.getElementById('batch-edit-modal-container');
            const batchEditCancelBtn = document.getElementById('batch-edit-cancel-btn');
            const batchEditApplyBtn = document.getElementById('batch-edit-apply-btn');
             
            // --- Table & Virtualization Config ---
            const TABLE_HEADERS = [
                { key: 'select', label: '<input type="checkbox" id="select-all-checkbox">', width: 40 },
                { key: 'rowNum', label: '#', width: 50 },
                { key: 'actions', label: 'Acciones', width: 80 }, { key: 'text', label: 'Texto de la Pregunta', width: 350 },
                { key: 'option_a', label: 'Opción A', width: 200 }, { key: 'option_b', label: 'Opción B', width: 200 },
                { key: 'option_c', label: 'Opción C', width: 200 }, { key: 'option_d', label: 'Opción D', width: 200 },
                { key: 'correctAnswerId', label: 'Resp. Correcta', width: 120 }, { key: 'category', label: 'Categoría', width: 150 },
                { key: 'year', label: 'Año', width: 100 }, { key: 'examType', label: 'Tipo Examen', width: 150 },
                { key: 'topic', label: 'Tema', width: 150 }, { key: 'justification', label: 'Justificación', width: 400 }
            ];
            const ROW_HEIGHT = 95;
            const OVERSCAN_COUNT = 5;
            const totalWidth = TABLE_HEADERS.reduce((acc, h) => acc + h.width, 0);
            const CATEGORIES = ["Cardiología", "Dermatología", "Gastroenterología", "Endocrinología", "Hematología", "Infectología", "Nefrología", "Neurología", "Neumología", "Reumatología", "Neonatologia", "Pediatria", "Ginecologia", "Obstetricia", "Cirugia general", "Oftalmologia", "Otorrinolaringología", "Traumatologia", "Urologia", "Psiquiatría", "Salud Pública / Epidemiología", "Bióetica"];
 
            // --- Core Functions ---
 
            function renderHeader() {
                tableHeader.innerHTML = '';
                const headerContent = document.createElement('div');
                headerContent.className = 'flex items-center bg-gray-50 font-medium text-xs text-gray-500 uppercase tracking-wider';
                headerContent.style.width = `${totalWidth}px`;
 
                TABLE_HEADERS.forEach(h => {
                    const cell = document.createElement('div');
                    cell.className = 'px-3 py-3 border-r border-gray-200 flex items-center justify-center';
                    cell.style.flex = `0 0 ${h.width}px`;
                    cell.innerHTML = h.label;
                    headerContent.appendChild(cell);
                });
                tableHeader.appendChild(headerContent);
                 
                document.getElementById('select-all-checkbox').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        selectedRows = new Set(questions.map((_, i) => i));
                    } else {
                        selectedRows.clear();
                    }
                    updateAdvancedToolbar();
                    renderVirtualRows();
                });
            }
 
            function renderVirtualRows() {
                const scrollTop = tableBodyContainer.scrollTop;
                const containerHeight = tableBodyContainer.clientHeight;
                 
                const startIndex = Math.max(0, Math.floor(scrollTop / ROW_HEIGHT) - OVERSCAN_COUNT);
                const endIndex = Math.min(questions.length, Math.ceil((scrollTop + containerHeight) / ROW_HEIGHT) + OVERSCAN_COUNT);
 
                tableBodySizer.style.height = `${questions.length * ROW_HEIGHT}px`;
                tableBody.innerHTML = '';
 
                for (let i = startIndex; i < endIndex; i++) {
                    const question = questions[i];
                    const row = document.createElement('div');
                    const isSelected = selectedRows.has(i);
                    row.className = `absolute top-0 left-0 w-full ${isSelected ? 'selected-row' : ''}`;
                    row.style.top = `${i * ROW_HEIGHT}px`;
                    row.style.height = `${ROW_HEIGHT}px`;
                    row.dataset.index = i;
 
                    const rowContent = document.createElement('div');
                    rowContent.className = 'flex items-stretch border-b border-gray-200 h-full';
                    rowContent.style.width = `${totalWidth}px`;
 
                    TABLE_HEADERS.forEach(header => {
                        const cell = document.createElement('div');
                        cell.className = 'px-2 py-1 flex items-center border-r border-gray-200 relative';
                        cell.style.flex = `0 0 ${header.width}px`;
 
                        if (header.key === 'select') {
                            cell.innerHTML = `<div class="w-full h-full flex items-center justify-center"><input type="checkbox" class="row-checkbox h-4 w-4" ${isSelected ? 'checked' : ''}></div>`;
                        } else if (header.key === 'rowNum') {
                            cell.innerHTML = `<div class="w-full h-full flex items-center justify-center text-sm text-gray-500">${i + 1}</div>`;
                        } else if (header.key === 'actions') {
                            cell.innerHTML = `<div class="w-full h-full flex items-center justify-center space-x-1">
                                <button class="p-2 text-blue-600 hover:text-blue-800 rounded-full transition-colors edit-btn" title="Editar">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                                </button>
                                <button class="p-2 text-red-600 hover:text-red-800 rounded-full transition-colors delete-btn" title="Eliminar Fila">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div>`;
                        } else {
                            const textarea = document.createElement('textarea');
                            textarea.className = 'w-full h-full p-2 border-transparent rounded-lg focus:ring-1 focus:ring-blue-400 focus:border-blue-500 text-sm bg-transparent hover:bg-gray-50 focus:bg-white resize-y cell-textarea';
                            textarea.value = question[header.key] || '';
                            textarea.dataset.field = header.key;
                            cell.appendChild(textarea);
                             if (header.key === 'category') {
                                const classifyBtn = document.createElement('button');
                                classifyBtn.className = 'absolute top-2 right-2 p-1 text-gray-400 hover:text-blue-600 classify-btn';
                                classifyBtn.title = 'Clasificar rápido';
                                classifyBtn.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg>`;
                                cell.appendChild(classifyBtn);
                            }
                        }
                        rowContent.appendChild(cell);
                    });
                    row.appendChild(rowContent);
                    tableBody.appendChild(row);
                }
            }
             
            function renderEmptyState() {
                tableBodySizer.style.height = 'auto';
                tableBody.innerHTML = `<div class="flex items-center justify-center h-full p-16"><div class="text-center"><h3 class="text-lg font-medium text-gray-600">Aún no hay preguntas</h3><p class="text-gray-500 mt-1">Haz clic en "Importar" para comenzar.</p></div></div>`;
            }
 
            function updateUI() {
                const hasQuestions = questions.length > 0;
                exportBtn.disabled = !hasQuestions;
                 
                if (hasQuestions) {
                    if (currentView === 'table') {
                        renderVirtualRows();
                    } else {
                        renderTextView();
                    }
                } else {
                    renderEmptyState();
                }
                updateAdvancedToolbar();
                saveState();
            }
 
            function showError(message) {
                errorContainer.textContent = message;
                errorContainer.classList.remove('hidden');
            }
 
            function hideError() {
                errorContainer.classList.add('hidden');
            }
 
            function processXmlContent(xmlString) {
                try {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlString, "application/xml");
                    const parserError = xmlDoc.querySelector("parsererror");
                    if (parserError) throw new Error("Error al analizar el archivo XML. Formato incorrecto.");
 
                    const questionNodes = xmlDoc.querySelectorAll("question[type='multichoice']");
                    const categoryNodes = Array.from(xmlDoc.querySelectorAll("question[type='category']"));
                    let currentCategory = "General";
                     
                    const parsedQuestions = Array.from(questionNodes).map(node => {
                        const questionTextNode = node.querySelector("questiontext > text");
                         
                        const precedingCategories = categoryNodes.filter(catNode => catNode.compareDocumentPosition(node) & Node.DOCUMENT_POSITION_FOLLOWING);
                        if(precedingCategories.length > 0){
                           const categoryText = precedingCategories[precedingCategories.length - 1].querySelector("category > text")?.textContent;
                           if(categoryText) currentCategory = categoryText.replace('$course$/', '').split('/').pop().trim() || "General";
                        }
 
                        const answerNodes = node.querySelectorAll("answer");
                        let justificationNode = node.querySelector("incorrectfeedback > text") || node.querySelector("generalfeedback > text");
                        const options = [];
                        let correctAnswerId = '';
                         
                        answerNodes.forEach((ans, index) => {
                            options.push(ans.querySelector("text")?.innerHTML || '');
                            if (parseFloat(ans.getAttribute("fraction")) === 100) correctAnswerId = String.fromCharCode(97 + index); 
                        });
 
                        return {
                            id: `q_${Date.now()}_${Math.random()}`, text: questionTextNode?.innerHTML || '',
                            option_a: options[0] || '', option_b: options[1] || '', option_c: options[2] || '', option_d: options[3] || '',
                            correctAnswerId, category: currentCategory, year: new Date().getFullYear().toString(),
                            justification: justificationNode?.innerHTML || '', examType: '', topic: '',
                        };
                    });
 
                    if (parsedQuestions.length === 0) {
                        showError("No se encontraron preguntas de opción múltiple en el archivo XML.");
                        questions = [];
                    } else {
                        hideError();
                        questions = parsedQuestions;
                    }
                    selectedRows.clear();
                    pushState(questions);
                    updateUI();
                } catch (e) {
                    console.error("XML Parsing Error:", e);
                    showError(e.message || "Ocurrió un error desconocido al procesar el archivo.");
                    questions = [];
                    updateUI();
                }
            }
             
            function processCsvContent(csvString, append = false) {
                try {
                    const parseCSV = (str) => {
                        const result = [];
                        let row = [];
                        let field = '';
                        let inQuotes = false;
                        str = str.trim() + '\n';
                        for (let i = 0; i < str.length; i++) {
                            const char = str[i];
                            if (inQuotes) {
                                if (char === '"') {
                                    if (str[i + 1] === '"') { field += '"'; i++; } else { inQuotes = false; }
                                } else { field += char; }
                            } else {
                                if (char === '"') { inQuotes = true; }
                                else if (char === ',') { row.push(field); field = ''; }
                                else if (char === '\n' || char === '\r') {
                                    if (str[i + 1] === '\n' && char === '\r') { i++; }
                                    row.push(field); result.push(row); row = []; field = '';
                                } else { field += char; }
                            }
                        }
                        return result;
                    };
 
                    const data = parseCSV(csvString);
                    let headers = data.shift();
                     
                    if (headers && headers.length > 0) {
                        if (headers[0].charCodeAt(0) === 0xFEFF) {
                            headers[0] = headers[0].substring(1);
                        }
                        headers = headers.map(h => h.trim().replace(/"/g, ''));
                    }
 
                    const requiredHeaders = TABLE_HEADERS.filter(h => !['actions', 'rowNum', 'select'].includes(h.key)).map(h => h.key);
 
                    if (!headers || headers.length !== requiredHeaders.length || !requiredHeaders.every((h, i) => headers[i] === h)) {
                        throw new Error("El archivo CSV no tiene el formato o las cabeceras correctas. El orden debe ser: " + requiredHeaders.join(', '));
                    }
 
                    const parsedQuestions = data.map(values => {
                        if (values.length === 0 || (values.length === 1 && values[0] === '')) return null;
                        if (values.length !== headers.length) { console.warn("Skipping malformed row:", values); return null; }
                        const question = {};
                        headers.forEach((header, i) => { question[header] = values[i] || ''; });
                        question.id = `q_${Date.now()}_${Math.random()}`;
                        return question;
                    }).filter(Boolean);
                     
                    if (append) {
                        pushState(questions);
                        questions.push(...parsedQuestions);
                    } else {
                        questions = parsedQuestions;
                        selectedRows.clear();
                        pushState(questions);
                    }
                     
                    hideError();
                    updateUI();
 
                } catch(e) {
                    console.error("CSV Parsing Error:", e);
                    showError(e.message || "Ocurrió un error al procesar el archivo CSV.");
                }
            }
 
 
            function exportToCsv() {
                if (questions.length === 0) return;
                const headers = TABLE_HEADERS.filter(h => !['actions', 'rowNum', 'select'].includes(h.key)).map(h => h.key);
                const sanitize = (data) => {
                    let text = (data || '').toString().replace(/<[^>]*>/g, '').replace(/"/g, '""');
                    return /[,"]|\n/.test(text) ? `"${text}"` : text;
                };
                const csvRows = [headers.join(','), ...questions.map(q => headers.map(h => sanitize(q[h])).join(','))];
                const blob = new Blob([csvRows.join('\n')], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = `${fileName}.csv`;
                link.click();
                URL.revokeObjectURL(link.href);
            }
 
            // --- Event Listeners ---
 
            importXmlBtn.addEventListener('click', () => xmlFileInput.click());
            importCsvBtn.addEventListener('click', () => csvFileInput.click());
            importPasteBtn.addEventListener('click', () => {
                pasteCsvArea.value = '';
                pasteModalContainer.classList.remove('hidden');
            });
 
            xmlFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.type === "text/xml") {
                        fileName = file.name.replace(/\.xml$/, '');
                        const reader = new FileReader();
                        reader.onload = (ev) => processXmlContent(ev.target.result);
                        reader.readAsText(file);
                    } else { showError("Por favor, sube un archivo XML válido."); }
                }
                e.target.value = null;
            });
 
            csvFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.type === "text/csv" || file.name.endsWith('.csv')) {
                         fileName = file.name.replace(/\.csv$/, '');
                        const reader = new FileReader();
                        reader.onload = (ev) => processCsvContent(ev.target.result);
                        reader.readAsText(file);
                    } else { showError("Por favor, sube un archivo CSV válido."); }
                }
                e.target.value = null;
            });
 
 
            exportBtn.addEventListener('click', exportToCsv);
             
            tableBodyContainer.addEventListener('scroll', (e) => {
                tableHeader.scrollLeft = e.currentTarget.scrollLeft;
                renderVirtualRows();
            });
            window.addEventListener('resize', renderVirtualRows);
 
            tableBody.addEventListener('input', (e) => {
                if (e.target.tagName === 'TEXTAREA') {
                    const field = e.target.dataset.field;
                    const index = parseInt(e.target.closest('[data-index]').dataset.index, 10);
                    const value = e.target.value;
 
                    clearTimeout(debounceTimers[index + field]);
                    debounceTimers[index + field] = setTimeout(() => {
                        if (questions[index] && questions[index][field] !== value) {
                            pushState(questions);
                            questions[index][field] = value;
                            saveState();
                        }
                    }, 500);
                }
            });
 
            tableBody.addEventListener('click', (e) => {
                const rowElement = e.target.closest('[data-index]');
                if (!rowElement) return;
                const index = parseInt(rowElement.dataset.index, 10);
 
                if (e.target.classList.contains('row-checkbox')) {
                    if (e.target.checked) {
                        selectedRows.add(index);
                    } else {
                        selectedRows.delete(index);
                    }
                    updateAdvancedToolbar();
                    renderVirtualRows();
                }
                if (e.target.closest('.edit-btn')) { openModal(index); }
                if (e.target.closest('.classify-btn')) { showClassifyPopup(e.target.closest('.classify-btn'), index); }
                if (e.target.closest('.delete-btn')) {
                    pushState(questions);
                    questions.splice(index, 1);
                    selectedRows.delete(index);
                    const newSelectedRows = new Set();
                    selectedRows.forEach(i => {
                        if (i > index) newSelectedRows.add(i - 1);
                        else if (i < index) newSelectedRows.add(i);
                    });
                    selectedRows = newSelectedRows;
                    updateUI();
                }
            });
 
            settingsBtn.addEventListener('click', () => settingsBar.classList.toggle('max-h-0'));
            globalYearInput.value = new Date().getFullYear();
 
            applyMassiveEditBtn.addEventListener('click', () => {
                if(questions.length === 0) return alert("Importa un archivo primero.");
                pushState(questions);
                const year = globalYearInput.value;
                const examType = globalExamInput.value;
                const category = globalCategoryInput.value;
                const topic = globalTopicInput.value;
 
                questions.forEach(q => {
                    if (year.trim()) q.year = year;
                    if (examType.trim()) q.examType = examType;
                    if (category.trim()) q.category = category;
                    if (topic.trim()) q.topic = topic;
                });
                updateUI();
                alert("¡Campos actualizados para todas las preguntas!");
            });
 
            // --- Modal Logic ---
            function openModal(index) {
                editingQuestionIndex = index;
                renderModalContent();
                modalContainer.classList.remove('hidden');
            }
             
            function renderModalContent() {
                const question = questions[editingQuestionIndex];
                if (!question) return;
 
                modalTitle.textContent = `Editando Pregunta ${editingQuestionIndex + 1} de ${questions.length}`;
                modalContent.innerHTML = '';
                 
                const contentWrapper = document.createElement('div');
                contentWrapper.className = 'grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4';
 
                TABLE_HEADERS.filter(h => !['actions', 'rowNum', 'select'].includes(h.key)).forEach(h => {
                    const isTextarea = ['text', 'justification'].includes(h.key);
                    const isFullWidth = ['text', 'justification'].includes(h.key);
                     
                    const fieldWrapper = document.createElement('div');
                    if (isFullWidth) { fieldWrapper.className = 'md:col-span-2'; }
 
                    const label = document.createElement('label');
                    label.className = 'block text-sm font-medium text-gray-700 mb-1';
                    label.textContent = h.label;
                     
                    let inputElement;
                    if (isTextarea) {
                        inputElement = document.createElement('textarea');
                        inputElement.rows = h.key === 'text' ? 4 : 3;
                    } else {
                        inputElement = document.createElement('input');
                        inputElement.type = 'text';
                    }
                    inputElement.className = 'w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm';
                    inputElement.dataset.field = h.key;
                    inputElement.value = question[h.key] || '';
 
                    fieldWrapper.appendChild(label);
                     
                    if (h.key === 'category') {
                        const categoryInputWrapper = document.createElement('div');
                        categoryInputWrapper.className = 'relative';
                        const classifyBtn = document.createElement('button');
                        classifyBtn.className = 'absolute top-1/2 right-2 -translate-y-1/2 p-1 text-gray-400 hover:text-blue-600 modal-classify-btn';
                        classifyBtn.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 14h.01M7 17h5a2 2 0 012 2v1a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a2 2 0 012-2z"></path></svg>`;
                        categoryInputWrapper.appendChild(inputElement);
                        categoryInputWrapper.appendChild(classifyBtn);
                        fieldWrapper.appendChild(categoryInputWrapper);
                    } else {
                         fieldWrapper.appendChild(inputElement);
                    }
                     
                    contentWrapper.appendChild(fieldWrapper);
                });
                modalContent.appendChild(contentWrapper);
                 
                modalPrevBtn.disabled = editingQuestionIndex === 0;
                modalNextBtn.disabled = editingQuestionIndex === questions.length - 1;
            }
 
            function saveCurrentModalState() {
                if (editingQuestionIndex === null) return;
                pushState(questions);
                const updatedQuestion = { ...questions[editingQuestionIndex] };
                modalContent.querySelectorAll('[data-field]').forEach(input => {
                    updatedQuestion[input.dataset.field] = input.value;
                });
                questions[editingQuestionIndex] = updatedQuestion;
            }
 
            function closeModal() {
                modalContainer.classList.add('hidden');
                editingQuestionIndex = null;
                updateUI();
            }
 
            modalSaveBtn.addEventListener('click', () => {
                saveCurrentModalState();
                closeModal();
            });
 
            modalCancelBtn.addEventListener('click', closeModal);
            modalContainer.addEventListener('click', (e) => {
                if (e.target === modalContainer) closeModal();
            });
             
            modalContent.addEventListener('click', (e) => {
                const classifyButton = e.target.closest('.modal-classify-btn');
                if (classifyButton) {
                    showClassifyPopup(classifyButton, editingQuestionIndex, true);
                }
            });
 
            modalPrevBtn.addEventListener('click', () => {
                if (editingQuestionIndex > 0) {
                    saveCurrentModalState();
                    editingQuestionIndex--;
                    renderModalContent();
                }
            });
 
            modalNextBtn.addEventListener('click', () => {
                if (editingQuestionIndex < questions.length - 1) {
                    saveCurrentModalState();
                    editingQuestionIndex++;
                    renderModalContent();
                }
            });
             
            // --- Paste CSV Modal Logic ---
            pasteCancelBtn.addEventListener('click', () => pasteModalContainer.classList.add('hidden'));
            pasteModalContainer.addEventListener('click', (e) => {
                if(e.target === pasteModalContainer) pasteModalContainer.classList.add('hidden');
            });
            pasteProcessBtn.addEventListener('click', () => {
                const text = pasteCsvArea.value;
                if(text.trim()){
                    processCsvContent(text, true); // Append pasted content
                }
                pasteModalContainer.classList.add('hidden');
            });
 
            // --- Quick Classify Popup Logic ---
            let currentClassifyIndex = null;
            let isModalClassify = false;
 
            function showClassifyPopup(button, index, isModal = false) {
                currentClassifyIndex = index;
                isModalClassify = isModal;
                 
                const rect = button.getBoundingClientRect();
                classifyPopup.style.top = `${rect.bottom + window.scrollY}px`;
                classifyPopup.style.left = `${rect.left + window.scrollX}px`;
                 
                classifySearch.value = '';
                renderClassifyList();
                classifyPopup.classList.remove('hidden');
                classifySearch.focus();
            }
             
            function renderClassifyList(filter = '') {
                classifyList.innerHTML = '';
                const filteredCategories = CATEGORIES.filter(cat => cat.toLowerCase().includes(filter.toLowerCase()));
                 
                filteredCategories.forEach(cat => {
                    const catButton = document.createElement('button');
                    catButton.className = 'block w-full text-left px-3 py-1.5 text-sm hover:bg-gray-100 rounded-md focus:bg-blue-100 focus:outline-none';
                    catButton.textContent = cat;
                    catButton.dataset.category = cat;
                    classifyList.appendChild(catButton);
                });
            }
 
            function hideClassifyPopup() {
                classifyPopup.classList.add('hidden');
                currentClassifyIndex = null;
                isModalClassify = false;
            }
 
            classifySearch.addEventListener('input', (e) => {
                renderClassifyList(e.target.value);
            });
             
            classifySearch.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    const firstButton = classifyList.querySelector('button');
                    if (firstButton) firstButton.focus();
                } else if (e.key === 'Escape') {
                    hideClassifyPopup();
                }
            });
 
            classifyList.addEventListener('keydown', (e) => {
                const currentButton = document.activeElement;
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    const nextButton = currentButton.nextElementSibling;
                    if (nextButton) nextButton.focus();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    const prevButton = currentButton.previousElementSibling;
                    if (prevButton) prevButton.focus();
                    else classifySearch.focus();
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    currentButton.click();
                } else if (e.key === 'Escape') {
                    hideClassifyPopup();
                }
            });
 
            classifyList.addEventListener('click', (e) => {
                if (e.target.dataset.category && currentClassifyIndex !== null) {
                    pushState(questions);
                    const selectedCategory = e.target.dataset.category;
                    if (isModalClassify) {
                        modalContent.querySelector('[data-field="category"]').value = selectedCategory;
                        modalContent.querySelector('[data-field="topic"]').value = selectedCategory;
                    } else {
                        questions[currentClassifyIndex].category = selectedCategory;
                        questions[currentClassifyIndex].topic = selectedCategory;
                        updateUI();
                    }
                    hideClassifyPopup();
                }
            });
 
            document.addEventListener('click', (e) => {
                if (!classifyPopup.classList.contains('hidden') && !e.target.closest('.classify-btn') && !e.target.closest('.modal-classify-btn') && !e.target.closest('#classify-popup')) {
                    hideClassifyPopup();
                }
            });
 
            // --- Advanced Toolbar Logic ---
            function updateAdvancedToolbar() {
                if (selectedRows.size > 0) {
                    selectionCount.textContent = `${selectedRows.size} fila${selectedRows.size > 1 ? 's' : ''} seleccionada${selectedRows.size > 1 ? 's' : ''}`;
                    advancedToolbar.classList.remove('hidden');
                } else {
                    advancedToolbar.classList.add('hidden');
                }
            }
 
            batchDeleteBtn.addEventListener('click', () => {
                pushState(questions);
                questions = questions.filter((_, index) => !selectedRows.has(index));
                selectedRows.clear();
                updateUI();
            });
 
            batchEditBtn.addEventListener('click', () => {
                document.getElementById('batch-year').value = '';
                document.getElementById('batch-exam').value = '';
                document.getElementById('batch-category').value = '';
                document.getElementById('batch-topic').value = '';
                batchEditModalContainer.classList.remove('hidden');
            });
 
            batchEditCancelBtn.addEventListener('click', () => batchEditModalContainer.classList.add('hidden'));
            batchEditApplyBtn.addEventListener('click', () => {
                pushState(questions);
                const year = document.getElementById('batch-year').value;
                const examType = document.getElementById('batch-exam').value;
                const category = document.getElementById('batch-category').value;
                const topic = document.getElementById('batch-topic').value;
 
                selectedRows.forEach(index => {
                    if (year.trim()) questions[index].year = year;
                    if (examType.trim()) questions[index].examType = examType;
                    if (category.trim()) questions[index].category = category;
                    if (topic.trim()) questions[index].topic = topic;
                });
                 
                batchEditModalContainer.classList.add('hidden');
                updateUI();
            });
 
            // --- History (Undo/Redo) and Autosave Logic ---
            function pushState(state) {
                history = history.slice(0, historyIndex + 1);
                history.push(JSON.parse(JSON.stringify(state)));
                historyIndex++;
                updateUndoRedoButtons();
            }
 
            function updateUndoRedoButtons() {
                undoBtn.disabled = historyIndex <= 0;
                redoBtn.disabled = historyIndex >= history.length - 1;
            }
 
            function undo() {
                if (historyIndex > 0) {
                    historyIndex--;
                    questions = JSON.parse(JSON.stringify(history[historyIndex]));
                    updateUI();
                    updateUndoRedoButtons();
                }
            }
 
            function redo() {
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    questions = JSON.parse(JSON.stringify(history[historyIndex]));
                    updateUI();
                    updateUndoRedoButtons();
                }
            }
             
            undoBtn.addEventListener('click', undo);
            redoBtn.addEventListener('click', redo);
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'z') { e.preventDefault(); undo(); }
                if (e.ctrlKey && e.key === 'y') { e.preventDefault(); redo(); }
            });
 
            function saveState(manual = false) {
                try {
                    localStorage.setItem('moodleQuestionsAutosave', JSON.stringify(questions));
                    localStorage.setItem('moodleFilenameAutosave', fileName);
                    if(manual) {
                        saveFeedback.classList.remove('fade-out');
                        void saveFeedback.offsetWidth; // Trigger reflow
                        saveFeedback.classList.add('fade-out');
                    }
                } catch (e) {
                    console.error("Error saving state to localStorage:", e);
                }
            }
 
            function loadState() {
                try {
                    const savedState = localStorage.getItem('moodleQuestionsAutosave');
                    if (savedState) {
                        questions = JSON.parse(savedState);
                        fileName = localStorage.getItem('moodleFilenameAutosave') || 'exportacion_moodle';
                        pushState(questions);
                    } else {
                        pushState([]);
                    }
                } catch (e) {
                    console.error("Error loading state from localStorage:", e);
                    questions = [];
                    pushState([]);
                }
            }
 
            saveBtn.addEventListener('click', () => saveState(true));
 
            window.addEventListener('beforeunload', (e) => {
                if (questions.length > 0) {
                    e.preventDefault();
                    e.returnValue = '';
                }
            });
 
 
            // --- View Toggling Logic ---
            function questionsToPlainText() {
                return questions.map((q, i) => {
                    return `## PREGUNTA ${i + 1} ##\n` +
                           `TEXTO: ${q.text || ''}\n` +
                           `A: ${q.option_a || ''}\n` +
                           `B: ${q.option_b || ''}\n` +
                           `C: ${q.option_c || ''}\n` +
                           `D: ${q.option_d || ''}\n` +
                           `RESPUESTA: ${q.correctAnswerId || ''}\n` +
                           `CATEGORIA: ${q.category || ''}\n` +
                           `AÑO: ${q.year || ''}\n` +
                           `TIPO_EXAMEN: ${q.examType || ''}\n` +
                           `TEMA: ${q.topic || ''}\n` +
                           `JUSTIFICACION: ${q.justification || ''}\n` +
                           `--------------------`;
                }).join('\n\n');
            }
 
            function plainTextToQuestions(text) {
                const newQuestions = [];
                const questionBlocks = text.split('--------------------');
                 
                questionBlocks.forEach((block, index) => {
                    if (block.trim() === '') return;
                     
                    const newQ = { id: `q_${Date.now()}_${Math.random()}` };
                    const lines = block.trim().split('\n');
                     
                    lines.forEach(line => {
                        if (line.startsWith('TEXTO:')) newQ.text = line.substring(6).trim();
                        else if (line.startsWith('A:')) newQ.option_a = line.substring(2).trim();
                        else if (line.startsWith('B:')) newQ.option_b = line.substring(2).trim();
                        else if (line.startsWith('C:')) newQ.option_c = line.substring(2).trim();
                        else if (line.startsWith('D:')) newQ.option_d = line.substring(2).trim();
                        else if (line.startsWith('RESPUESTA:')) newQ.correctAnswerId = line.substring(10).trim();
                        else if (line.startsWith('CATEGORIA:')) newQ.category = line.substring(10).trim();
                        else if (line.startsWith('AÑO:')) newQ.year = line.substring(4).trim();
                        else if (line.startsWith('TIPO_EXAMEN:')) newQ.examType = line.substring(12).trim();
                        else if (line.startsWith('TEMA:')) newQ.topic = line.substring(5).trim();
                        else if (line.startsWith('JUSTIFICACION:')) newQ.justification = line.substring(14).trim();
                    });
                    newQuestions.push(newQ);
                });
                return newQuestions;
            }
 
            toggleViewBtn.addEventListener('click', () => {
                if (currentView === 'table') {
                    // Switch to text view
                    textViewArea.value = questionsToPlainText();
                    tableView.classList.add('hidden');
                    textView.classList.remove('hidden');
                    tableViewIcon.classList.add('hidden');
                    textViewIcon.classList.remove('hidden');
                    currentView = 'text';
                } else {
                    // Switch to table view
                    pushState(questions);
                    questions = plainTextToQuestions(textViewArea.value);
                    textView.classList.add('hidden');
                    tableView.classList.remove('hidden');
                    textViewIcon.classList.add('hidden');
                    tableViewIcon.classList.remove('hidden');
                    currentView = 'table';
                    updateUI();
                }
            });
 
 
            // --- Initial Render ---
            loadState();
            renderHeader();
            updateUI();
        });
    </script>
 
 
</body></html>
